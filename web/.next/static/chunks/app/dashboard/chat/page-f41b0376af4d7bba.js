(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{3941:(e,t,s)=>{"use strict";s.d(t,{U:()=>d});var r=s(5417);let a=null;function d(){return a?a:a=(0,r.createBrowserClient)("https://placeholder.supabase.co","placeholder")}},5016:(e,t,s)=>{"use strict";s.d(t,{cn:()=>d});var r=s(2821),a=s(5889);function d(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.QP)((0,r.$)(t))}},5110:(e,t,s)=>{Promise.resolve().then(s.bind(s,6100))},6100:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(5155),a=s(2115),d=s(3941),n=s(63),l=s(5016);function i(e){var t;let{pool:s}=e,a=String(s.symbol||"Unknown"),d=String(s.project||"Unknown"),n="number"==typeof s.apy?s.apy.toFixed(2):"—",l="number"==typeof s.tvlUsd?(t=s.tvlUsd)>=1e6?"$".concat((t/1e6).toFixed(1),"M"):t>=1e3?"$".concat((t/1e3).toFixed(0),"K"):"$".concat(t.toFixed(0)):"—";return(0,r.jsx)("div",{className:"rounded-lg border border-border bg-background p-3 text-xs",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-foreground",children:a}),(0,r.jsx)("p",{className:"text-muted",children:d})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"font-medium text-accent",children:[n,"% APY"]}),(0,r.jsxs)("p",{className:"text-muted",children:[l," TVL"]})]})]})})}function o(){let[e,t]=(0,a.useState)(null),[s,o]=(0,a.useState)([]),[c,u]=(0,a.useState)(""),[m,x]=(0,a.useState)(!1),p=(0,a.useRef)(null),f=(0,n.useSearchParams)(),h=(0,n.useRouter)(),b=(0,d.U)(),g=f.get("agent");async function v(t){if(t.preventDefault(),!c.trim()||!e||m)return;let s=c.trim();u(""),x(!0);let{data:{user:r}}=await b.auth.getUser();r&&(await b.from("messages").insert({agent_id:e.id,user_id:r.id,role:"user",content:s,metadata:{}}),x(!1))}return((0,a.useEffect)(()=>{if(!g)return void h.push("/dashboard");!async function(){let[{data:e},{data:s}]=await Promise.all([b.from("agents").select("*").eq("id",g).single(),b.from("messages").select("*").eq("agent_id",g).order("created_at",{ascending:!0}).limit(100)]);if(!e)return h.push("/dashboard");t(e),o(s||[])}()},[g,h,b]),(0,a.useEffect)(()=>{if(!g)return;let e=b.channel("messages:".concat(g)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"agent_id=eq.".concat(g)},e=>{let t=e.new;o(e=>e.some(e=>e.id===t.id)?e:[...e,t])}).subscribe();return()=>{b.removeChannel(e)}},[g,b]),(0,a.useEffect)(()=>{var e;null==(e=p.current)||e.scrollIntoView({behavior:"smooth"})},[s]),e)?(0,r.jsxs)("div",{className:"flex h-[calc(100vh-57px)] flex-col",children:[(0,r.jsxs)("div",{className:"border-b border-border px-4 py-3",children:[(0,r.jsx)("p",{className:"font-medium",children:e.name}),(0,r.jsxs)("p",{className:"text-xs text-muted capitalize",children:[e.vibe_mode," mode \xb7 Risk ",e.risk_tolerance,"/5"]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===s.length&&(0,r.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,r.jsx)("p",{className:"text-muted",children:"Send a message to start chatting with your agent"})}),s.map(e=>(0,r.jsx)("div",{className:(0,l.cn)("flex","user"===e.role?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:(0,l.cn)("max-w-[80%] rounded-lg px-4 py-3 text-sm whitespace-pre-wrap","user"===e.role?"bg-primary/20 text-foreground":"bg-card border border-border text-foreground"),children:[e.content,e.metadata&&"object"==typeof e.metadata&&"pools"in e.metadata&&Array.isArray(e.metadata.pools)&&(0,r.jsx)("div",{className:"mt-3 space-y-2",children:e.metadata.pools.map((e,t)=>(0,r.jsx)(i,{pool:e},t))})]})},e.id)),m&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("div",{className:"rounded-lg border border-border bg-card px-4 py-3 text-sm text-muted",children:"Thinking..."})}),(0,r.jsx)("div",{ref:p})]}),(0,r.jsx)("form",{onSubmit:v,className:"border-t border-border p-4",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:c,onChange:e=>u(e.target.value),placeholder:"Ask about yields, wallets, strategies...",className:"flex-1 rounded-lg border border-border bg-input px-4 py-3 text-sm text-foreground placeholder:text-muted focus:border-primary focus:outline-none"}),(0,r.jsx)("button",{type:"submit",disabled:!c.trim()||m,className:"rounded-lg bg-primary px-6 py-3 text-sm font-medium text-foreground hover:bg-primary-hover disabled:opacity-50",children:"Send"})]})})]}):(0,r.jsx)("p",{className:"py-12 text-center text-muted",children:"Loading..."})}}},e=>{e.O(0,[92,909,441,255,358],()=>e(e.s=5110)),_N_E=e.O()}]);